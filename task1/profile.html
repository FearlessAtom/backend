<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="form-container">
        <div>
            <input id="user-name" type="text" required minlength="4" maxlength="16" placeholder="Username">
        </div>

        <div>
            <input id="email-address" type="text" required placeholder="Email address">
        </div>

        <div style="width: 100%; display: flex; justify-content: flex-end">
            <button onclick="saveAccount()">Save</button>
        </div>

        <div style="width: 100%; display: flex; justify-content: flex-end">
            <button onclick="deleteAccount()">Delete account</button>
        </div>
    </div>
</body>
<script defer>
    const user_id = sessionStorage.getItem("user_id");

    if (!user_id)
    {
        window.location = "login.html";
    }

    const user_name_input = document.querySelector("#user-name");
    const email_address_input = document.querySelector("#email-address");

    (async() =>
    {
        const response = await fetch(`http://localhost/users/${user_id}`);
        const user = await response.json();

        user_name_input.value = user.user_name;
        email_address_input.value = user.email_address;
    })();

    async function deleteAccount()
    {
        let confirmation = confirm("Are you sure you want to delete your account?");

        if (!confirmation)
        {
            return;
        }

        await fetch(`http://localhost/users/${user_id}`, { method: "DELETE" });
        sessionStorage.setItem("user_id", "");
        window.location = "login.html";
    }

    async function saveAccount()
    {
        data = 
        {
            user_name: user_name_input.value,
            email_address: email_address_input.value,
        }

        const response = await fetch(`http://localhost/users/${user_id}`, 
        {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
        });
    }
</script>
</html>
